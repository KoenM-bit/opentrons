{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "opentronsLiquidClassSchemaV1",
  "title": "Liquid Class Schema",
  "description": "Schema for defining a single liquid class's properties for liquid handling functions.",
  "type": "object",
  "definitions": {
    "positiveNumber": {
      "type": "number",
      "minimum": 0
    },
    "safeString": {
      "description": "a string safe to use for namespace. Lowercase-only.",
      "type": "string",
      "pattern": "^[a-z0-9._]+$"
    },
    "delay": {
      "type": "object",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Whether delay is enabled."
        },
        "duration": {
          "#ref": "#/definitions/positiveNumber",
          "description": "Duration of delay, in seconds."
        }
      },
      "description": "Delay properties.",
      "if": {
        "properties": {
          "enable": { "const": true }
        }
      },
      "then": {
        "required": ["enable", "duration"]
      },
      "else": {
        "required": ["enable"]
      }
    },
    "positionReference": {
      "type": "string",
      "description": "Reference point for positioning (e.g., bottom, top, liquid surface).",
      "enum": ["bottom", "top", "center", "meniscus"]
    },
    "coordinate": {
      "type": "object",
      "description": "3-dimensional coordinate.",
      "properties": {
        "x": {
          "type": "number"
        },
        "y": {
          "type": "number"
        },
        "z": {
          "type": "number"
        }
      },
      "required": ["x", "y", "z"]
    },
    "touchTip": {
      "type": "object",
      "description": "Shared properties for the touch-tip function.",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Whether touch-tip is enabled."
        },
        "zOffset": {
          "type": "number",
          "description": "Offset from the top of the well for touch-tip, in millimeters."
        },
        "mmToEdge": {
          "type": "number",
          "description": "Offset away from the the well edge, in millimeters."
        },
        "speed": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Touch-tip speed, in millimeters per second."
        }
      },
      "if": {
        "properties": {
          "enable": { "const": true }
        }
      },
      "then": {
        "required": ["enable", "zOffset", "mmToEdge", "speed"]
      },
      "else": {
        "required": ["enable"]
      }
    },
    "mix": {
      "type": "object",
      "description": "Mixing properties.",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Whether mix is enabled."
        },
        "repetitions": {
          "type": "integer",
          "description": "Number of mixing repetitions.",
          "minimum": 0
        },
        "volume": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Volume used for mixing, in microliters."
        }
      },
      "if": {
        "properties": {
          "enable": { "const": true }
        }
      },
      "then": {
        "required": ["enable", "repetitions", "volume"]
      },
      "else": {
        "required": ["enable"]
      }
    },
    "blowout": {
      "type": "object",
      "description": "Blowout properties.",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Whether blow-out is enabled."
        },
        "location": {
          "type": "string",
          "enum": ["source", "destination", "trash"],
          "description": "Location well or trash entity for blow out."
        },
        "flowRate": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Flow rate for blow out, in microliters per second."
        }
      },
      "if": {
        "properties": {
          "enable": { "const": true }
        }
      },
      "then": {
        "required": ["enable", "location", "flowRate"]
      },
      "else": {
        "required": ["enable"]
      }
    },
    "submerge": {
      "type": "object",
      "description": "Shared properties for the submerge function before aspiration or dispense.",
      "properties": {
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "speed": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Speed of submerging, in millimeters per second."
        },
        "delay": {
          "$ref": "#/definitions/delay"
        }
      },
      "required": ["positionReference", "offset", "speed", "delay"]
    },
    "retractAspirate": {
      "type": "object",
      "description": "Shared properties for the retract function after aspiration or dispense.",
      "properties": {
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "speed": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Speed of retraction, in millimeters per second."
        },
        "airGap": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Air gap volume after retract, in microliters."
        },
        "touchTip": {
          "$ref": "#/definitions/touchTip"
        },
        "delay": {
          "$ref": "#/definitions/delay"
        }
      },
      "required": ["positionReference", "offset", "speed", "airGap", "delay"],
      "additionalProperties": false
    },
    "retractDispense": {
      "type": "object",
      "description": "Shared properties for the retract function after aspiration or dispense.",
      "properties": {
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "speed": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Speed of retraction, in millimeters per second."
        },
        "airGap": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Air gap volume after retract, in microliters."
        },
        "blowout": {
          "$ref": "#/definitions/blowout"
        },
        "touchTip": {
          "$ref": "#/definitions/touchTip"
        },
        "delay": {
          "$ref": "#/definitions/delay"
        }
      },
      "required": [
        "positionReference",
        "offset",
        "speed",
        "airGap",
        "blowout",
        "delay"
      ],
      "additionalProperties": false
    },
    "aspirateParams": {
      "type": "object",
      "description": "Parameters specific to the aspirate function.",
      "properties": {
        "submerge": {
          "$ref": "#/definitions/submerge"
        },
        "retract": {
          "$ref": "#/definitions/retractAspirate"
        },
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "flowRate": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Flow rate for aspirating, in microliters per second."
        },
        "preWet": {
          "type": "boolean",
          "description": "Whether to perform a pre-wet action."
        },
        "mix": {
          "$ref": "#/definitions/mix"
        },
        "delay": {
          "$ref": "#/definitions/delay"
        }
      },
      "required": [
        "submerge",
        "retract",
        "positionReference",
        "offset",
        "flowRate",
        "preWet",
        "mix",
        "delay"
      ],
      "additionalProperties": false
    },
    "singleDispenseParams": {
      "type": "object",
      "description": "Parameters specific to the single-dispense function.",
      "properties": {
        "submerge": {
          "$ref": "#/definitions/submerge"
        },
        "retract": {
          "$ref": "#/definitions/retractDispense"
        },
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "flowRate": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Flow rate for dispense, in microliters per second."
        },
        "mix": {
          "$ref": "#/definitions/mix"
        },
        "pushOutVolume": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Push out volume at dispense, in microliters."
        },
        "delay": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Delay after dispense, in seconds."
        }
      },
      "required": [
        "submerge",
        "retract",
        "positionReference",
        "offset",
        "flowRate",
        "mix",
        "pushOutVolume",
        "delay"
      ],
      "additionalProperties": false
    },
    "multiDispenseParams": {
      "type": "object",
      "description": "Parameters specific to the multi-dispense function.",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Whether multi-dispense is enabled."
        },
        "submerge": {
          "$ref": "#/definitions/submerge"
        },
        "retract": {
          "$ref": "#/definitions/retractDispense"
        },
        "positionReference": {
          "$ref": "#/definitions/positionReference"
        },
        "offset": {
          "$ref": "#/definitions/coordinate"
        },
        "flowRate": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Flow rate for dispensing, in microliters per second."
        },
        "mix": {
          "$ref": "#/definitions/mix"
        },
        "conditioningVolume": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Volume used for conditioning during dispense, in microliters."
        },
        "disposalVolume": {
          "$ref": "#/definitions/positiveNumber",
          "description": "Volume discarded during dispense, in microliters."
        },
        "delay": {
          "$ref": "#/definitions/delay"
        }
      },
      "if": {
        "properties": {
          "enable": { "const": true }
        }
      },
      "then": {
        "required": [
          "enable",
          "submerge",
          "retract",
          "positionReference",
          "offset",
          "flowRate",
          "mix",
          "conditioningVolume",
          "disposalVolume",
          "delay"
        ]
      },
      "else": {
        "required": ["enable"]
      },
      "additionalProperties": false
    }
  },
  "required": ["liquidName", "schemaVersion", "namespace", "byPipette"],
  "properties": {
    "liquidName": {
      "type": "string",
      "description": "The name of the liquid (e.g., water, ethanol, serum)."
    },
    "schemaVersion": {
      "description": "Which schema version a liquid class is using",
      "type": "number",
      "enum": [1]
    },
    "namespace": {
      "$ref": "#/definitions/safeString"
    },
    "byPipette": {
      "type": "array",
      "description": "Liquid class settings by each pipette compatible with this liquid class.",
      "items": {
        "type": "object",
        "description": "The settings for a specific kind of pipette when interacting with this liquid class",
        "properties": {
          "pipetteModel": {
            "type": "string",
            "description": "The pipette model this applies to"
          },
          "byTipType": {
            "type": "array",
            "description": "Settings for each kind of tip this pipette can use",
            "items": {
              "type": "object",
              "properties": {
                "tipType": {
                  "type": "string",
                  "description": "The tip type whose properties will be used when handling this specific liquid class with this pipette"
                },
                "aspirate": {
                  "$ref": "#/definitions/aspirateParams"
                },
                "singleDispense": {
                  "$ref": "#/definitions/singleDispenseParams"
                },
                "multiDispense": {
                  "$ref": "#/definitions/multiDispenseParams"
                }
              },
              "required": ["aspirate", "singleDispense", "multiDispense"]
            }
          }
        },
        "required": ["pipetteModel", "byTipType"]
      }
    }
  },
  "additionalProperties": false
}
